registries:
  registry.gitlab.com:
    username: user_$CI_BUILD_ID
    password: $PASS
  registry2.gitlab.com:
    username: $USER
    password: $PASS

stages:
  - Test
  - build
  - test
  - deploy

jobs:
  - name: PHPUnit
    stage: Test
    image: sunasteriskrnd/php-workspace:7.4
    registry: registry.gitlab.com
    workspace: shared
    environment:
    - APP_ENV=testing
    script:
    - echo "Generate coverage file"
    - echo 'xxx' > sharedWorkspace
    coverage:
      type: clover
      path: coverage_php.xml
    artifacts:
      name: aaaa
      expires_in: 3 days
      paths:
      - coverage.xml
      
  - name: Cobertura
    stage: test
    image: sunasteriskrnd/php-workspace:7.4
    environment:
    - APP_ENV=testing1
    script:
    - echo "Generate cobertura2  file"
    coverage:
      type: cobertura
      path: cobertura.xml
  
  - name: Jacoco
    stage: test
    image: sunasteriskrnd/php-workspace:7.4
    environment:
    - APP_ENV=testing1
    script:
    - echo "Generate jacoco  file"
    coverage:
      type: jacoco
      path: coverage.xml
  
  - name: Demo0
    stage: Test
    image: sunasteriskrnd/php-workspace:7.4
    workspace: shared
    environment:
    - APP_ENV=testing
    script:
    - echo "Generate coverage file"
    - cat sharedWorkspace
    artifacts:
      name: hahaha
      expires_in: 3 days
      paths:
      - coverage.xml
